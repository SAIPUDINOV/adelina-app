name: Simple APK Build

on: [workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
    
    - name: Create minimal project
      run: |
        # Создаем проект без AndroidX
        mkdir -p app/src/main/java/com/adelina/app/
        mkdir -p app/src/main/res/layout/
        
        # gradle.properties
        echo 'android.useAndroidX=true' > gradle.properties
        
        # Manifest
        echo '<?xml version="1.0" encoding="utf-8"?>
        <manifest xmlns:android="http://schemas.android.com/apk/res/android">
          <uses-permission android:name="android.permission.INTERNET"/>
          <application android:label="Adelina Space">
            <activity android:name=".MainActivity" android:exported="true">
              <intent-filter>
                <action android:name="android.intent.action.MAIN"/>
                <category android:name="android.intent.category.LAUNCHER"/>
              </intent-filter>
            </activity>
          </application>
        </manifest>' > app/src/main/AndroidManifest.xml
        
        # Layout
        echo '<?xml version="1.0" encoding="utf-8"?>
        <WebView xmlns:android="http://schemas.android.com/apk/res/android"
          android:id="@+id/webview"
          android:layout_width="match_parent"
          android:layout_height="match_parent"/>' > app/src/main/res/layout/activity_main.xml
        
        # Activity без зависимостей
        echo 'package com.adelina.app;
        import android.app.Activity;
        import android.os.Bundle;
        import android.webkit.WebView;
        
        public class MainActivity extends Activity {
          @Override
          protected void onCreate(Bundle savedInstanceState) {
            super.onCreate(savedInstanceState);
            WebView webView = new WebView(this);
            webView.getSettings().setJavaScriptEnabled(true);
            webView.loadUrl("https://adelina.space/home.aspx");
            setContentView(webView);
          }
        }' > app/src/main/java/com/adelina/app/MainActivity.java
        
        # Простой build.gradle
        echo 'plugins {
          id "com.android.application"
        }
        
        android {
          compileSdk 33
          
          defaultConfig {
            applicationId "com.adelina.app"
            minSdk 21
            targetSdk 33
          }
        }
        
        dependencies {}' > app/build.gradle
        
        echo 'include ":app"' > settings.gradle
    
    - name: Build
      run: |
        wget https://services.gradle.org/distributions/gradle-7.5-bin.zip
        unzip gradle-7.5-bin.zip
        ./gradle-7.5/bin/gradle assembleDebug
    
    - uses: actions/upload-artifact@v4
      with:
        name: Adelina-App
        path: app/build/outputs/apk/debug/*.apk
